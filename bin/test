#!/usr/bin/env php
<?php
require \dirname(__DIR__) . '/vendor/autoload.php';
define("APP_ROOT", dirname(__FILE__));

use Amp\Loop;
use Amp\Process\Process;

$diff = 0;
$count = 0;
$last = microtime(1);
$process = new Process("sleep 3");
$promise = $process->start();

function tick() {
  global $diff, $count, $last, $process;
    $t = microtime(1);
    $count++;
    $diff += ($t - $last);
		$last = $t;
		print_r(['promise' => $process->isRunning()]);
}

echo "-- before Loop::run()\n";

Loop::run(function() {
    Loop::repeat($msInterval = 500, "tick");
    Loop::delay($msDelay = 5000, "Amp\\Loop::stop");
});

echo "-- after Loop::run()\n";

print $count . "\n" . ($diff/$count);
